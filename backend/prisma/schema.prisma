generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String         @id @default(cuid())
  uniqueId         String?        @unique
  email            String?        @unique
  phone            String?        @unique
  password         String?
  role             UserRole
  isActive         Boolean        @default(true)
  isVerified       Boolean        @default(false)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  adminProfile     Admin?
  clubProfile      Club?
  coachProfile     Coach?
  instituteProfile Institute?
  notifications    Notification[]
  otpRecords       OTPRecord[]
  payments         Payment[]
  studentProfile   Student?

  @@map("users")
}

model OTPRecord {
  id        String   @id @default(cuid())
  userId    String
  code      String
  type      OTPType
  expiresAt DateTime
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("otp_records")
}

model Student {
  id                 String                   @id @default(cuid())
  userId             String                   @unique
  name               String
  fatherName         String?
  aadhaar            String?                  @unique
  gender             String?
  dateOfBirth        DateTime?
  state              String?
  district           String?
  address            String?
  pincode            String?
  sport              String?
  sport2             String?
  sport3             String?
  level              String?
  school             String?
  club               String?
  coachName          String?
  coachMobile        String?
  achievements       String?
  profileCompletion  Int                      @default(0)
  createdAt          DateTime                 @default(now())
  updatedAt          DateTime                 @updatedAt
  clubMembers        ClubMember[]
  eventRegistrations EventRegistration[]
  instituteStudents  InstituteStudent[]
  coachConnections   StudentCoachConnection[]
  user               User                     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("students")
}

model Coach {
  id                    String                   @id @default(cuid())
  userId                String                   @unique
  name                  String
  fatherName            String?
  motherName            String?
  aadhaar               String?                  @unique
  gender                String?
  dateOfBirth           DateTime?
  state                 String?
  district              String?
  address               String?
  pincode               String?
  panNumber             String?                  @unique
  utrNumber             String?
  membershipStatus      String?                  @default("NEW")
  applyingAs            String?                  @default("Chief District coordinator")
  primarySport          String?
  otherSports           String?
  specialization        String?
  experience            Int?
  certifications        String?
  bio                   String?
  location              String?
  city                  String?
  paymentStatus         PaymentStatus            @default(PENDING)
  subscriptionType      SubscriptionType?
  subscriptionExpiresAt DateTime?
  isActive              Boolean                  @default(false)
  rating                Float?                   @default(0)
  totalStudents         Int                      @default(0)
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  user                  User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  eventOrders           EventOrder[]
  eventResultFiles      EventResultFile[]
  events                Event[]
  instituteCoaches      InstituteCoach[]
  payments              Payment[]
  studentConnections    StudentCoachConnection[]

  @@map("coaches")
}

model Institute {
  id            String             @id @default(cuid())
  userId        String             @unique
  name          String
  type          String?
  location      String?
  city          String?
  state         String?
  pincode       String?
  established   String?
  sportsOffered String?
  studentsCount Int                @default(0)
  coachesCount  Int                @default(0)
  paymentStatus PaymentStatus      @default(PENDING)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  coaches       InstituteCoach[]
  students      InstituteStudent[]
  user          User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("institutes")
}

model Club {
  id              String        @id @default(cuid())
  userId          String        @unique
  name            String
  type            String?
  location        String?
  city            String?
  state           String?
  established     String?
  facilities      String?
  membershipTypes String?
  membersCount    Int           @default(0)
  paymentStatus   PaymentStatus @default(PENDING)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  members         ClubMember[]
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("clubs")
}

model Admin {
  id              String       @id @default(cuid())
  userId          String       @unique
  name            String
  role            AdminRole    @default(ADMIN)
  permissions     String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  processedOrders EventOrder[]

  @@map("admins")
}

model StudentCoachConnection {
  id          String           @id @default(cuid())
  studentId   String
  coachId     String
  status      ConnectionStatus @default(PENDING)
  initiatedBy InitiatedBy
  message     String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  coach       Coach            @relation(fields: [coachId], references: [id], onDelete: Cascade)
  student     Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, coachId])
  @@map("student_coach_connections")
}

model InstituteStudent {
  id          String    @id @default(cuid())
  instituteId String
  studentId   String
  createdAt   DateTime  @default(now())
  institute   Institute @relation(fields: [instituteId], references: [id], onDelete: Cascade)
  student     Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([instituteId, studentId])
  @@map("institute_students")
}

model InstituteCoach {
  id          String    @id @default(cuid())
  instituteId String
  coachId     String
  createdAt   DateTime  @default(now())
  coach       Coach     @relation(fields: [coachId], references: [id], onDelete: Cascade)
  institute   Institute @relation(fields: [instituteId], references: [id], onDelete: Cascade)

  @@unique([instituteId, coachId])
  @@map("institute_coaches")
}

model ClubMember {
  id             String       @id @default(cuid())
  clubId         String
  studentId      String
  membershipType String?
  status         MemberStatus @default(ACTIVE)
  joinedAt       DateTime     @default(now())
  club           Club         @relation(fields: [clubId], references: [id], onDelete: Cascade)
  student        Student      @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([clubId, studentId])
  @@map("club_members")
}

model Event {
  id                  String              @id @default(cuid())
  name                String
  description         String?
  sport               String
  venue               String
  address             String?
  city                String
  state               String
  latitude            Float?
  longitude           Float?
  startDate           DateTime
  endDate             DateTime?
  maxParticipants     Int                 @default(50)
  currentParticipants Int                 @default(0)
  eventFee            Float               @default(0)
  status              EventStatus         @default(PENDING)
  adminNotes          String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  coachId             String
  orders              EventOrder[]
  payments            EventPayment[]
  registrations       EventRegistration[]
  resultFiles         EventResultFile[]
  coach               Coach               @relation(fields: [coachId], references: [id], onDelete: Cascade)

  @@map("events")
}

model EventRegistration {
  id        String             @id @default(cuid())
  eventId   String
  studentId String
  status    RegistrationStatus @default(PENDING)
  message   String?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  event     Event              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  student   Student            @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([eventId, studentId])
  @@map("event_registrations")
}

model Payment {
  id                String        @id @default(cuid())
  userId            String?
  userType          UserRole?
  coachId           String?
  type              PaymentType
  amount            Float
  currency          String        @default("INR")
  razorpayOrderId   String?
  razorpayPaymentId String?
  status            PaymentStatus @default(PENDING)
  description       String?
  metadata          String?
  expiresAt         DateTime?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  coach             Coach?        @relation(fields: [coachId], references: [id])
  user              User?         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model EventPayment {
  id                String        @id @default(cuid())
  eventId           String
  amount            Float
  currency          String        @default("INR")
  razorpayOrderId   String?
  razorpayPaymentId String?
  status            PaymentStatus @default(PENDING)
  description       String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  event             Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_payments")
}

model EventResultFile {
  id           String   @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  uploadedAt   DateTime @default(now())
  eventId      String
  coachId      String
  description  String?
  coach        Coach    @relation(fields: [coachId], references: [id], onDelete: Cascade)
  event        Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_result_files")
}

model EventOrder {
  id                  String        @id @default(cuid())
  orderNumber         String        @unique
  certificates        Int           @default(0)
  medals              Int           @default(0)
  trophies            Int           @default(0)
  specialInstructions String?
  urgentDelivery      Boolean       @default(false)
  certificatePrice    Float?
  medalPrice          Float?
  trophyPrice         Float?
  totalAmount         Float?
  status              OrderStatus   @default(PENDING)
  adminRemarks        String?
  paymentStatus       PaymentStatus @default(PENDING)
  razorpayOrderId     String?
  razorpayPaymentId   String?
  paymentDate         DateTime?
  paymentMethod       String?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  processedAt         DateTime?
  completedAt         DateTime?
  eventId             String
  coachId             String
  processedBy         String?
  coach               Coach         @relation(fields: [coachId], references: [id], onDelete: Cascade)
  event               Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  admin               Admin?        @relation(fields: [processedBy], references: [id])

  @@map("event_orders")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  data      String?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  readAt    DateTime?
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

enum UserRole {
  STUDENT
  COACH
  INSTITUTE
  CLUB
  ADMIN
}

enum OTPType {
  REGISTRATION
  LOGIN
  PASSWORD_RESET
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

enum PaymentType {
  REGISTRATION
  SUBSCRIPTION_MONTHLY
  SUBSCRIPTION_ANNUAL
  EVENT_FEE
  SUBSCRIPTION
}

enum SubscriptionType {
  MONTHLY
  ANNUAL
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  REJECTED
  BLOCKED
}

enum InitiatedBy {
  STUDENT
  COACH
  INSTITUTE
  CLUB
}

enum EventStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
  ACTIVE
  CANCELLED
  COMPLETED
}

enum RegistrationStatus {
  PENDING
  REGISTERED
  APPROVED
  REJECTED
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  AUTHORIZER
  VIEWER
}

enum MemberStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PAYMENT_PENDING
  PAID
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NotificationType {
  EVENT_APPROVED
  EVENT_REJECTED
  EVENT_SUSPENDED
  EVENT_RESTARTED
  ORDER_CONFIRMED
  ORDER_IN_PROGRESS
  ORDER_COMPLETED
  ORDER_CANCELLED
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  GENERAL
}
